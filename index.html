<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://snowy-king-2ff2.phantomworx.workers.dev http://www.airbusdriver.net; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
  <title>CQ Line Pilot Comments</title>
  <link rel="dns-prefetch" href="https://snowy-king-2ff2.phantomworx.workers.dev">
  <link rel="preconnect" href="https://snowy-king-2ff2.phantomworx.workers.dev" crossorigin>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header>
    <h1>CQ Line Pilot Intel</h1>
    <p>Filter and review the latest CQ line pilot comments in a cleaner, responsive layout.</p>
  </header>
  <main>
    <section class="controls">
      <!-- Primary Action Bar -->
      <div class="action-bar">
        <div class="sort-group">
          <select id="sortOrder" class="compact-select">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
          </select>
        </div>

        <div class="spacer"></div>

        <button id="toggleDatePanel" class="control-pill" aria-expanded="false">
          <span class="icon">üìÖ</span>
          <span class="label">Date</span>
          <span id="dateBadge" class="badge" style="display: none;">‚Ä¢</span>
        </button>

        <button id="toggleSearchPanel" class="control-pill" aria-expanded="false">
          <span class="icon">üîç</span>
          <span class="label">Search</span>
          <span id="searchBadge" class="badge" style="display: none;">‚Ä¢</span>
        </button>
      </div>

      <!-- Collapsible Panels -->
      <div id="datePanel" class="panel filter-panel" hidden>
        <div class="panel-content">
          <!-- Quick Chips -->
          <div class="quick-chips">
            <button class="chip" data-range="3m" aria-label="Filter results to last 3 months">Last 3 Months</button>
            <button class="chip" data-range="6m" aria-label="Filter results to last 6 months">Last 6 Months</button>
            <button class="chip" data-range="ytd" aria-label="Filter results to current year">Current Year</button>
          </div>

          <div class="picker-divider"></div>

          <!-- Custom Month Pickers -->
          <div class="date-pickers-container">
            <!-- Start Date Picker -->
            <div class="month-picker" id="startPicker">
              <div class="picker-header">
                <span class="picker-label">Start Date</span>
                <div class="year-nav">
                  <button class="nav-btn prev-year" aria-label="Previous year">‚Äπ</button>
                  <span class="current-year">2023</span>
                  <button class="nav-btn next-year" aria-label="Next year">‚Ä∫</button>
                </div>
              </div>
              <div class="months-grid">
                <!-- Javascript will populate buttons: <button value="0">Jan</button>... -->
              </div>
              <input type="hidden" id="startMonthValue"> <!-- YYYY-MM -->
            </div>

            <!-- End Date Picker -->
            <div class="month-picker" id="endPicker">
              <div class="picker-header">
                <span class="picker-label">End Date</span>
                <div class="year-nav">
                  <button class="nav-btn prev-year" aria-label="Previous year">‚Äπ</button>
                  <span class="current-year">2023</span>
                  <button class="nav-btn next-year" aria-label="Next year">‚Ä∫</button>
                </div>
              </div>
              <div class="months-grid">
                <!-- Javascript will populate buttons -->
              </div>
              <input type="hidden" id="endMonthValue"> <!-- YYYY-MM -->
            </div>
          </div>

          <div class="actions">
            <button id="applyDateFilter" class="small-btn">Apply</button>
            <button id="resetDateFilter" class="small-btn secondary">Clear</button>
          </div>
        </div>
      </div>

      <div id="searchPanel" class="panel search-panel" hidden>
        <div class="panel-content">
          <div class="search-row">
            <input type="text" id="searchInput" placeholder="Search keywords..." />
            <button id="applySearch" class="small-btn">Go</button>
            <button id="clearSearch" class="small-btn secondary">Clear</button>
          </div>
          <div class="radio-group horizontal">
            <label class="radio-label">
              <input type="radio" name="searchScope" value="filtered" checked />
              <span>Filtered</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="searchScope" value="all" />
              <span>All</span>
            </label>
          </div>
        </div>
      </div>
    </section>
    <section class="manual-input">
      <div class="control-group">
        <label for="sourceUrl">Fetch HTML from a URL (optional)</label>
        <input type="url" id="sourceUrl" placeholder="http://www.airbusdriver.net/airbus_CQT_Intel.htm"
          value="http://www.airbusdriver.net/airbus_CQT_Intel.htm" />
        <small class="status">If the request is blocked by CORS, download the HTML and paste it below.</small>
      </div>
      <div class="actions">
        <button id="fetchUrl" class="secondary">Fetch URL</button>
      </div>
      <div class="control-group">
        <label for="manualHtml">Paste HTML from the target page</label>
        <textarea id="manualHtml"
          placeholder="Paste the HTML source for http://www.airbusdriver.net/airbus_CQT_Intel.htm"></textarea>
      </div>
      <div class="actions">
        <button id="parseHtml" class="secondary">Parse pasted HTML</button>
      </div>
    </section>

    <div class="status" id="status">Paste the HTML source to load entries.</div>
    <div id="noResultsMessage" class="no-results" style="display: none;">
      <div class="no-results-content">
        <p class="no-results-title">No comments found</p>
        <p class="no-results-text" id="noResultsText"></p>
      </div>
    </div>
    <section class="cards" id="cards"></section>

    <footer class="cache-info">
      <div id="cacheStatus" class="cache-status"></div>
      <button id="refreshDataBtn" class="refresh-btn" style="display: none;">Refresh Data</button>
      <div class="theme-toggle">
        <span>Theme:</span>
        <button class="theme-toggle-btn" id="themeAuto">Auto</button>
        <button class="theme-toggle-btn" id="themeLight">Light</button>
        <button class="theme-toggle-btn" id="themeDark">Dark</button>
      </div>
    </footer>
  </main>

  <div class="modal" id="entryModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div>
          <h2 id="modalTitle">Entry details</h2>
          <div class="modal-meta" id="modalMeta"></div>
        </div>
        <button class="modal-close" id="closeModal" type="button" aria-label="Close full entry">
          ‚úï
        </button>
      </div>
      <div class="modal-body">
        <p id="modalBody"></p>
      </div>
    </div>
  </div>

  <div class="modal" id="disclaimerModal" aria-hidden="false">
    <div class="modal-content disclaimer-modal-content" role="dialog" aria-modal="true"
      aria-labelledby="disclaimerTitle">
      <div class="modal-header">
        <h2 id="disclaimerTitle">Welcome</h2>
      </div>
      <div class="modal-body">
        <p>This site is simply a modern mobile-friendly viewer for the AirBusDriver.net CQ comments. All comments are
          pulled directly from the original site without modification.</p>
      </div>
      <div class="modal-footer">
        <button id="disclaimerAccept">I understand</button>
      </div>
    </div>
  </div>


  <!-- jsPDF loaded lazily only when needed - see app.js loadPdfLibraries() -->
  <script src="app.js" defer></script>
</body>

</html>